<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('partials/head') %>
  <style>
    .page-header {
      margin-bottom: 2rem;
      padding-bottom: 2rem;
      border-bottom: 1px solid var(--border-color);
    }

    .action-buttons {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .action-buttons form {
      display: inline;
      margin: 0;
    }
  </style>
</head>
<body>
  <%- include('partials/navbar') %>

  <div class="container mt-5 mb-5">
    <div class="page-header d-flex justify-content-between align-items-center">
      <div>
        <h1 style="margin: 0; color: var(--text-primary);">
          <i class="fas fa-users"></i> User Management
        </h1>
        <p style="color: var(--text-secondary); margin-top: 0.5rem;">Manage all system users</p>
      </div>
      <a href="/admin/dashboard" class="btn btn-outline-primary">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
      </a>
    </div>
    
    <%- include('partials/messages') %>

    <div class="table-responsive">
      <table class="table table-bordered mt-3">
        <thead class="table-dark">
          <tr>
            <th><i class="fas fa-hashtag"></i> ID</th>
            <th><i class="fas fa-user"></i> Username</th>
            <th><i class="fas fa-envelope"></i> Email</th>
            <th><i class="fas fa-id-card"></i> Full Name</th>
            <th><i class="fas fa-phone"></i> Phone</th>
            <th><i class="fas fa-badge"></i> Role</th>
            <th><i class="fas fa-check-circle"></i> Status</th>
            <th><i class="fas fa-cog"></i> Actions</th>
          </tr>
        </thead>
        <tbody>
          <% users.forEach(user => { %>
            <tr>
              <td><strong><%= user.userId %></strong></td>
              <td><%= user.username %></td>
              <td><%= user.email %></td>
              <td><%= user.fullName || '-' %></td>
              <td><%= user.phone || '-' %></td>
              <td>
                <span class="badge" style="background-color: <%= user.roleId == 2 ? '#1a73e8' : '#5f6368' %>;">
                  <%= user.roleId == 2 ? 'Admin' : 'User' %>
                </span>
              </td>
              <td>
                <% if (user.isFrozen) { %>
                  <span class="badge bg-danger">
                    <i class="fas fa-lock"></i> Frozen
                  </span>
                <% } else { %>
                  <span class="badge bg-success">
                    <i class="fas fa-check"></i> Active
                  </span>
                <% } %>
              </td>
              <td>
                <div class="action-buttons">
                  <a href="/admin/users/edit/<%= user.userId %>" class="btn btn-sm btn-primary">
                    <i class="fas fa-edit"></i> Edit
                  </a>

                  <% if (user.isFrozen) { %>
                    <form action="/admin/users/unfreeze/<%= user.userId %>" method="POST">
                      <button type="submit" class="btn btn-sm btn-success">
                        <i class="fas fa-unlock"></i> Unfreeze
                      </button>
                    </form>
                  <% } else { %>
                    <form action="/admin/users/freeze/<%= user.userId %>" method="POST">
                      <button type="submit" class="btn btn-sm btn-warning">
                        <i class="fas fa-lock"></i> Freeze
                      </button>
                    </form>
                  <% } %>

                  <form action="/admin/users/delete/<%= user.userId %>" method="POST">
                    <button type="submit" class="btn btn-sm btn-danger"
                            onclick="return confirm('Are you sure you want to delete this user? This action cannot be undone.');">
                      <i class="fas fa-trash-alt"></i> Delete
                    </button>
                  </form>
                </div>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>

    <% if (users.length === 0) { %>
      <div class="text-center mt-4">
        <p style="color: var(--text-secondary); font-size: 1.1rem;">
          <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 1rem;"></i><br>
          No users found in the system.
        </p>
      </div>
    <% } %>
  </div>

  <%- include('partials/footer') %>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
  