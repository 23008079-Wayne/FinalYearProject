<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('partials/head') %>
  <title>Register - Marketmind</title>
</head>
<body>

  <%- include('partials/navbar') %>

  <div class="container mt-5 mb-5" style="max-width: 600px;">
    <div class="auth-container">
      <h2>Create Your Account</h2>

      <%- include('partials/messages') %>

      <form action="/register" method="POST">
        <div class="mb-3">
          <label class="form-label">Full Name</label>
          <input type="text" name="fullName" class="form-control" placeholder="Enter your full name">
        </div>

        <div class="mb-3">
          <label class="form-label">Username</label>
          <input type="text" name="username" class="form-control" required placeholder="Choose a username">
        </div>

        <div class="mb-3">
          <label class="form-label">Email Address</label>
          <input type="email" name="email" class="form-control" required placeholder="Enter your email">
        </div>

        <div class="mb-3">
          <label class="form-label">Password</label>
          <input 
            type="password" 
            name="password" 
            id="password"
            class="form-control" 
            required 
            minlength="8"
            pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$"
            title="Password must be at least 8 characters, and include uppercase, lowercase, number, and special character."
            placeholder="Create a password">
          <small class="text-muted d-block mt-2">
            Must be at least 8 characters with uppercase, lowercase, number, and special character
          </small>

          <!-- Password strength meter -->
          <div class="mt-3">
            <div class="progress" style="height: 6px; background-color: #e2e8f0;">
              <div 
                id="passwordStrengthBar" 
                class="progress-bar" 
                role="progressbar" 
                style="width: 0%; background-color: #ef4444;"></div>
            </div>
            <small id="passwordStrengthText" class="text-muted d-block mt-1"></small>
          </div>
        </div>

        <div class="mb-4">
          <label class="form-label">Confirm Password</label>
          <input 
            type="password" 
            name="confirmPassword" 
            id="confirmPassword"
            class="form-control" 
            required 
            placeholder="Confirm your password">
          <small id="passwordMatchText" class="text-muted d-block mt-1"></small>
        </div>

        <button type="submit" class="btn btn-primary w-100">Create Account</button>
      </form>

      <div class="form-divider">or</div>

      <p class="text-center">
        Already have an account? <a href="/login">Sign in here</a>
      </p>
    </div>
  </div>

  <%- include('partials/footer') %>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Password strength + match JS -->
  <script>
    (function () {
      const passwordInput = document.getElementById('password');
      const confirmInput = document.getElementById('confirmPassword');
      const strengthBar = document.getElementById('passwordStrengthBar');
      const strengthText = document.getElementById('passwordStrengthText');
      const matchText = document.getElementById('passwordMatchText');

      if (!passwordInput || !strengthBar) return;

      function evaluateStrength(password) {
        let score = 0;
        if (!password) return 0;

        if (password.length >= 8) score++;
        if (/[a-z]/.test(password)) score++;
        if (/[A-Z]/.test(password)) score++;
        if (/\d/.test(password)) score++;
        if (/[@$!%*?&]/.test(password)) score++;

        return score;
      }

      function updateStrengthMeter() {
        const pwd = passwordInput.value;
        const score = evaluateStrength(pwd);

        let width = 0;
        let label = '';
        let barColor = '#ef4444';

        if (score <= 1) {
          width = 20;
          label = 'Very weak';
          barColor = '#ef4444';
        } else if (score === 2) {
          width = 40;
          label = 'Weak';
          barColor = '#ef4444';
        } else if (score === 3) {
          width = 60;
          label = 'Moderate';
          barColor = '#f59e0b';
        } else if (score === 4) {
          width = 80;
          label = 'Strong';
          barColor = '#10b981';
        } else if (score >= 5) {
          width = 100;
          label = 'Very strong';
          barColor = '#10b981';
        }

        strengthBar.style.width = width + '%';
        strengthBar.style.backgroundColor = barColor;
        strengthText.textContent = pwd ? ('Strength: ' + label) : '';
        strengthText.style.color = barColor;
      }

      function updateMatchText() {
        const pwd = passwordInput.value;
        const confirm = confirmInput.value;

        if (!confirm && !pwd) {
          matchText.textContent = '';
          matchText.className = 'text-muted d-block mt-1';
          return;
        }

        if (pwd && confirm && pwd === confirm) {
          matchText.textContent = '✓ Passwords match';
          matchText.className = 'text-success d-block mt-1';
          matchText.style.color = '#10b981';
        } else if (confirm) {
          matchText.textContent = '✗ Passwords do not match';
          matchText.className = 'text-danger d-block mt-1';
          matchText.style.color = '#ef4444';
        }
      }

      passwordInput.addEventListener('input', function () {
        updateStrengthMeter();
        updateMatchText();
      });

      if (confirmInput) {
        confirmInput.addEventListener('input', updateMatchText);
      }
    })();
  </script>
</body>
</html>
